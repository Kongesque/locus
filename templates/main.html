<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZoneNet</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}">
</head>

<body class="bg-background text-sidebar-foreground h-screen overflow-hidden">

    <div id="loading" class="loading-overlay">
        <img src="">
        <p></p>
        <span></span>
    </div>

    <!-- Mobile Backdrop -->
    <div id="backdrop" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-40 hidden lg:hidden"
        onclick="toggleSidebar()"></div>

    <!-- Main Layout Container -->
    <div id="app-container" class="flex h-screen">

        <!-- Sidebar -->
        <aside id="sidebar"
            class="fixed lg:relative z-50 h-full bg-sidebar border-r border-sidebar-border lg:border-r-0 flex flex-col overflow-hidden transition-all duration-300 ease-in-out -translate-x-full lg:translate-x-0 w-64 lg:w-0"
            data-expanded="false">

            <!-- Sidebar Header -->
            <div class="flex items-center justify-between px-4 py-3 border-b border-sidebar-border">
                <a href="{{ url_for('main') }}" class="flex items-center gap-3 no-underline">
                    <div class="w-8 h-8 bg-sidebar-accent rounded-lg flex items-center justify-center shrink-0">
                        <span class="text-sidebar-accent-foreground font-bold text-sm">Z</span>
                    </div>
                    <span id="sidebar-title"
                        class="text-lg font-semibold text-sidebar-foreground tracking-tight hidden">ZoneNet</span>
                </a>
            </div>

            <!-- Sidebar Content (empty for now) -->
            <nav class="flex-1 p-2 space-y-1">
                <!-- Add navigation items here later -->
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col min-w-0 overflow-auto">

            <!-- Header -->
            <header id="content" class="flex justify-between items-center px-2 py-2">
                <a href="{{ url_for('main') }}" class="no-underline">
                    <div class="text-lg font-semibold text-text-color tracking-tight">ZoneNet</div>
                </a>
                <div class="flex items-center gap-2">
                    <button class="btn-secondary">Feedback</button>
                    <a href="https://github.com/Kongesque" target="_blank"
                        class="w-6 h-6 flex items-center justify-center rounded-full">
                        <img src="{{ url_for('static', filename='img/github.svg') }}" class="w-6 h-6 invert opacity-80">
                    </a>
                </div>
            </header>


            <!-- Main Content -->
            <main id="content"
                class="relative flex-1 flex items-center justify-center flex-col text-center mx-2 mt-1 mb-2 overflow-hidden bg-sidebar border border-sidebar-border rounded-md">

                <!-- Sidebar Toggle -->
                <button onclick="toggleSidebar()"
                    class="absolute top-4 left-4 p-1 rounded-md hover:bg-sidebar-accent transition-colors">
                    <img src="{{ url_for('static', filename='img/sidebar.svg') }}"
                        class="w-4.5 h-4.5 invert opacity-80">
                </button>

                <div class="mb-4">
                    <h1 class="text-3xl md:text-5xl font-bold text-sidebar-foreground tracking-tight leading-tight">
                        What do you want to count?
                    </h1>
                </div>

                <div class="flex items-center justify-center px-4">

                    <form id="uploadForm" method='POST' enctype="multipart/form-data" hidden>
                        {{ form.hidden_tag() }}
                        <div class="custom-file">
                            {{ form.file(class_="custom-file-input", id="fileInput", accept="video/*") }}
                            <label class="custom-file-label" for="customFile">New Upload file</label>
                        </div>
                        <input id="dummy" type="submit" name="anything_submit" value="Submit" onclick="loading();"
                            hidden>
                    </form>

                    <label for="input-file" id="drop-area"
                        class="w-full max-w-[420px] p-8 md:p-10 text-center rounded-xl cursor-pointer transition-all duration-200 border border-dashed border-muted-foreground hover:border-sidebar-foreground hover:bg-sidebar-accent">
                        <div id="file-view" class="flex flex-col items-center gap-4 md:gap-6">
                            <div class="flex items-center gap-3">
                                <img src="{{ url_for('static', filename='img/upload.svg') }}"
                                    class="w-6 h-6 invert opacity-60">
                                <span class="text-sidebar-foreground font-medium">Choose Files</span>
                            </div>
                            <p class="text-sm text-muted-foreground">or drop it here</p>
                            <div class="flex items-center gap-3">
                                <span
                                    class="px-3 py-1 text-xs text-muted-foreground border border-muted-foreground rounded-full">.MP4</span>
                                <span
                                    class="px-3 py-1 text-xs text-muted-foreground border border-muted-foreground rounded-full">.WebM</span>
                            </div>
                        </div>
                    </label>

                </div>
            </main>
        </div>
    </div>

    <script src="{{url_for('static', filename='script/main.js')}}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        // Sidebar state
        let sidebarExpanded = false;

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');
            const title = document.getElementById('sidebar-title');
            const labels = document.querySelectorAll('.sidebar-label');
            const isMobile = window.innerWidth < 1024;

            sidebarExpanded = !sidebarExpanded;
            sidebar.dataset.expanded = sidebarExpanded;

            if (isMobile) {
                // Mobile: slide in/out overlay
                if (sidebarExpanded) {
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                    backdrop.classList.remove('hidden');
                } else {
                    sidebar.classList.remove('translate-x-0');
                    sidebar.classList.add('-translate-x-full');
                    backdrop.classList.add('hidden');
                }
                // Always show labels on mobile when open
                title.classList.toggle('hidden', !sidebarExpanded);
                labels.forEach(l => l.classList.toggle('hidden', !sidebarExpanded));
            } else {
                // Desktop: push sidebar width toggle
                if (sidebarExpanded) {
                    sidebar.classList.remove('lg:w-0', 'lg:border-r-0');
                    sidebar.classList.add('lg:w-64', 'lg:border-r');
                } else {
                    sidebar.classList.remove('lg:w-64', 'lg:border-r');
                    sidebar.classList.add('lg:w-0', 'lg:border-r-0');
                }
                // Toggle labels visibility
                title.classList.toggle('hidden', !sidebarExpanded);
                labels.forEach(l => l.classList.toggle('hidden', !sidebarExpanded));
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');
            const isMobile = window.innerWidth < 1024;

            if (!isMobile && sidebarExpanded) {
                // Reset mobile states when switching to desktop
                sidebar.classList.remove('-translate-x-full');
                sidebar.classList.add('translate-x-0');
                backdrop.classList.add('hidden');
            } else if (isMobile && !sidebarExpanded) {
                // Hide sidebar on mobile when collapsed
                sidebar.classList.add('-translate-x-full');
                sidebar.classList.remove('translate-x-0');
            }
        });

        $(document).ready(function () {
            $('#loading').hide();
        });

        function loading() {
            $("header#content").hide();
            $("main#content").hide();
            $("footer#content").hide();
            $("#loading").show();
            $("#loading img").attr("src", "{{ url_for('static', filename='img/cow.gif') }}");
            $("#loading p").text("Uploading files...");
            $("#loading span").html("The process may take a moment, please<br>keep this window open.");
        };
    </script>
</body>

</html>